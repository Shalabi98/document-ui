<nav class="navbar navbar-expand-lg navbar-dark bg-white shadow-sm mb-4">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img
        src="assets/images/logo-aquarius.png"
        alt="Aquarius Consulting"
        height="45"
      />
    </a>

    <span class="navbar-text text-secondary small fw-bold">
      <i class="bi bi-circle-fill text-success small me-1"></i> Live Connection
      Active
    </span>
  </div>
</nav>

<div class="container">
  <div class="row mb-3 align-items-center">
    <div class="col">
      <h3 class="fw-bold text-secondary">Document Dashboard</h3>
      <p class="text-muted small">Real-time incoming invoices and receipts.</p>
    </div>
    <div class="card bg-light border-0 mb-3 shadow-sm" *ngIf="filterFlag">
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-4">
            <input
              type="text"
              class="form-control"
              placeholder="Filter by RUC..."
              [(ngModel)]="filterRuc"
            />
          </div>
          <div class="col-md-4">
            <input type="date" class="form-control" [(ngModel)]="filterDate" />
          </div>
          <div class="col-md-4 text-end">
            <button
              class="btn btn-link text-decoration-none small"
              (click)="clearFilters()"
            >
              Clear All
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card border-0 shadow-lg rounded-3 overflow-hidden">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light text-uppercase text-muted small">
            <tr>
              <th class="ps-4 py-3">Type</th>
              <th>Document Number</th>
              <th>Issuer (RUC)</th>
              <th>Date</th>
              <th class="text-end">Amount</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let doc of filteredDocuments" class="fade-in-row">
              <td class="ps-4">
                <span
                  class="badge rounded-pill"
                  [ngClass]="{
                    'bg-success': doc.documentType === 'INVOICE',
                    'bg-info text-dark': doc.documentType === 'RECEIPT',
                    'bg-warning text-dark': doc.documentType === 'TICKET'
                  }"
                >
                  {{ doc.documentType }}
                </span>
              </td>
              <td class="fw-bold text-dark">{{ doc.documentNumber }}</td>
              <td class="text-muted">{{ doc.issuerRuc }}</td>
              <td>
                <div class="d-flex align-items-center">
                  <i class="bi bi-calendar3 text-muted me-2"></i>
                  {{ doc.documentDate | date : "mediumDate" }}
                </div>
              </td>
              <td class="text-end fw-bold text-primary">
                {{ doc.amount | currency : "PEN " : "symbol" : "1.2-2" }}
              </td>
              <td class="text-center">
                <button
                  class="btn btn-sm btn-light text-primary border shadow-sm"
                  (click)="selectDocument(doc)"
                  data-bs-toggle="modal"
                  data-bs-target="#detailModal"
                >
                  <i class="bi bi-eye-fill"></i> View
                </button>
              </td>
            </tr>

            <tr *ngIf="documents.length === 0">
              <td colspan="6" class="text-center py-5 text-muted">
                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                Waiting for incoming scans...
              </td>
            </tr>
          </tbody>
        </table>
        <div
          class="card-footer bg-white border-0 py-3 d-flex justify-content-between align-items-center"
        >
          <span class="text-muted small">
            Showing page <strong>{{ currentPage + 1 }}</strong> of
            <strong>{{ totalPages }}</strong> (Total: {{ totalItems }})
          </span>

          <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="currentPage === 0">
                <button
                  class="page-link"
                  (click)="changePage(currentPage - 1)"
                  aria-label="Previous"
                >
                  <span aria-hidden="true">&laquo; Prev</span>
                </button>
              </li>

              <li class="page-item disabled">
                <span class="page-link border-0 text-dark fw-bold">{{
                  currentPage + 1
                }}</span>
              </li>

              <li
                class="page-item"
                [class.disabled]="currentPage >= totalPages - 1"
              >
                <button
                  class="page-link"
                  (click)="changePage(currentPage + 1)"
                  aria-label="Next"
                >
                  <span aria-hidden="true">Next &raquo;</span>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
    <div class="card-footer bg-white border-0 py-3 text-end text-muted small">
      Total Records: {{ documents.length }}
    </div>
  </div>
</div>

<!-- <div class="modal fade" id="detailModal" tabindex="-1" *ngIf="selectedDoc">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-receipt me-2"></i> Document Details
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="selectedDoc = null"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-5 border-end">
            <h6 class="text-uppercase text-muted small fw-bold">Metadata</h6>
            <div class="mb-3">
              <label class="small text-muted d-block">Document Type</label>
              <span class="badge bg-secondary">{{
                selectedDoc.documentType
              }}</span>
            </div>
            <div class="mb-3">
              <label class="small text-muted d-block">Issuer RUC</label>
              <strong>{{ selectedDoc.issuerRuc }}</strong>
            </div>
            <div class="mb-3">
              <label class="small text-muted d-block">Invoice Number</label>
              <span class="font-monospace">{{
                selectedDoc.documentNumber
              }}</span>
            </div>
            <div class="mb-3">
              <label class="small text-muted d-block">Date of Issue</label>
              {{ selectedDoc.documentDate | date : "fullDate" }}
            </div>
            <div class="p-3 bg-light rounded text-center">
              <label class="small text-muted d-block">Total Amount</label>
              <h2 class="text-success m-0">
                {{ selectedDoc.amount | currency : "PEN " }}
              </h2>
            </div>
          </div>

          <div class="col-md-7 text-center">
            <h6 class="text-uppercase text-muted small fw-bold mb-3">
              Scanned Source
            </h6>
            <div
              class="ratio ratio-4x3 bg-dark rounded overflow-hidden shadow-sm"
            >
              <img
                [src]="selectedDoc.imageBase64"
                class="img-fluid object-fit-contain"
                alt="Scan"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> -->

<div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="bi bi-receipt me-2"></i> Document Details
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          (click)="selectedDoc = null"
        ></button>
      </div>

      <div class="modal-body" *ngIf="selectedDoc">
        <div class="row g-3">
          <div class="col-md-5 border-end">
            <h6 class="text-uppercase text-muted small fw-bold">Metadata</h6>
            <div class="mb-3">
              <label class="small text-muted d-block">Document Type</label>
              <span class="badge bg-secondary">{{
                selectedDoc.documentType
              }}</span>
            </div>
            <div class="mb-3">
              <label class="small text-muted d-block">Issuer RUC</label>
              <strong>{{ selectedDoc.issuerRuc }}</strong>
            </div>
            <div class="mb-3">
              <label class="small text-muted d-block">Invoice Number</label>
              <span class="font-monospace">{{
                selectedDoc.documentNumber
              }}</span>
            </div>
            <div class="mb-3">
              <label class="small text-muted d-block">Date of Issue</label>
              {{ selectedDoc.documentDate | date : "fullDate" }}
            </div>
            <div class="p-3 bg-light rounded text-center">
              <label class="small text-muted d-block">Total Amount</label>
              <h2 class="text-success m-0">
                {{ selectedDoc.amount | currency : "PEN " }}
              </h2>
            </div>
          </div>

          <div class="col-md-7 text-center">
            <h6 class="text-uppercase text-muted small fw-bold mb-3">
              Scanned Source
            </h6>
            <div
              class="ratio ratio-4x3 bg-dark rounded overflow-hidden shadow-sm"
            >
              <img
                [src]="getSafeUrl(selectedDoc.imageBase64)"
                class="img-fluid object-fit-contain"
                alt="Scan"
              />
            </div>
          </div>
        </div>
      </div>

      <div class="modal-body text-center p-5" *ngIf="!selectedDoc">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
  </div>
</div>
